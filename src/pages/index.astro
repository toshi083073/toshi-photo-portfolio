---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { listPhotos, listArticles, listVideos } from "../lib/data";

const photos = await listPhotos();
const videos = await listVideos();      // videos.json から取得
const posts  = await listArticles();

const BASE = (import.meta.env.BASE_URL || "/").replace(/\/?$/, "/");

// Hero（frontmatter の hero:true を優先）
const heroPhoto = photos.find((p: any) => p?.hero) ?? photos[0];
const hero = heroPhoto?.image ?? `${BASE}photos/_DSC02094_s%202.jpg`;

// 写真 + 動画の混在配列
const media = [
  ...videos, // { type:"youtube", id:"UJ5o-s1oiv4", title:"Tokyo Tower in August 2025" } など
  ...photos.slice(0, 12).map(p => ({
    type: "photo",
    src: p.image,
    href: `${BASE}photos/${p.slug}`,
    title: p.title,
  })),
];
---

<Layout title="Toshi Kuramochi — Visual Stories">
  <!-- 💫 ナビ -->
  <header class="nav">
    <!-- ✅ ロゴをトップページリンク化 -->
    <div class="logo">
    <a href={BASE} aria-label="Home">
      <span class="circle-logo">T</span>
      <span class="logo-text">Toshi</span>
    </a>
    </div>

    <!-- 左：テキストリンク -->
    <nav>
      <a href="#journal">Journal</a>
      <a href={`${BASE}contact`}>Contact</a>
    </nav>

    <!-- 右：SNSアイコン（public/icons/*.svg を利用） -->
    <div class="social" aria-label="Social links">
      <a href="https://www.instagram.com/toshi30aug/" target="_blank" rel="noopener" aria-label="Instagram">
        <img src={`${BASE}icons/instagram.svg`} width="22" height="22" alt="Instagram" />
      </a>
      <a href="https://toshi0830.substack.com/" target="_blank" rel="noopener" aria-label="Substack">
        <img src={`${BASE}icons/substack.svg`} width="22" height="22" alt="Substack" />
      </a>
      <a href="https://www.youtube.com/@toshkuram" target="_blank" rel="noopener" aria-label="YouTube">
        <img src={`${BASE}icons/youtube.svg`} width="22" height="22" alt="YouTube" />
      </a>
      <a href="https://x.com/10tksom28" target="_blank" rel="noopener" aria-label="X">
        <img src={`${BASE}icons/x.svg`} width="22" height="22" alt="X (Twitter)" />
      </a>
    </div>
  </header>

  <!-- 🌆 ヒーロー -->
  <section class="hero">
    <img src={hero} alt="Hero" loading="eager" decoding="async" />
  </section>

  <!-- 📸🎥 混在ギャラリー（3列） -->
  <section class="gallery">
    {media.map((m) => {
      if (m.type === "photo") {
        return (
          <a href={m.href} class="card" aria-label={m.title}>
            <div class="ratio">
              <img src={m.src} alt={m.title} loading="lazy" decoding="async" />
            </div>
          </a>
        );
      } else if (m.type === "youtube") {
        return (
          <div class="card video" aria-label={m.title}>
            <div class="ratio">
              <iframe
                src={`https://www.youtube.com/embed/${m.id}?autoplay=0&mute=1&rel=0&modestbranding=1`}
                title={m.title}
                allow="autoplay; fullscreen"
                loading="lazy"
              ></iframe>
            </div>
          </div>
        );
      } else {
        return null;
      }
    })}
  </section>

  <!-- 📰 Journal -->
  <section id="journal" class="journal">
    <h2>Journal</h2>
    <div class="posts">
      {posts.slice(0, 4).map(a => (
        <a href={`${BASE}posts/${a.slug}`} class="post" aria-label={a.title}>
          {a.cover && <img src={a.cover} alt={a.title} loading="lazy" />}
          <div class="meta">
            <strong>{a.title}</strong>
            <span>{a.date}</span>
          </div>
        </a>
      ))}
    </div>
  </section>

  <!-- ⚙️ Footer（中央にSNSアイコン） -->
  <footer class="footer">
    <div class="footer-social" aria-label="Social links">
      <a href="https://www.instagram.com/toshi30aug/" target="_blank" rel="noopener" aria-label="Instagram">
        <img src={`${BASE}icons/instagram.svg`} width="26" height="26" alt="Instagram" />
      </a>
      <a href="https://toshi0830.substack.com/" target="_blank" rel="noopener" aria-label="Substack">
        <img src={`${BASE}icons/substack.svg`} width="26" height="26" alt="Substack" />
      </a>
      <a href="https://www.youtube.com/@toshkuram" target="_blank" rel="noopener" aria-label="YouTube">
        <img src={`${BASE}icons/youtube.svg`} width="26" height="26" alt="YouTube" />
      </a>
      <a href="https://x.com/10tksom28" target="_blank" rel="noopener" aria-label="X">
        <img src={`${BASE}icons/x.svg`} width="26" height="26" alt="X (Twitter)" />
      </a>
    </div>
  </footer>
</Layout>
