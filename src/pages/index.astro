---
import Layout from '../layouts/Layout.astro';
import { listPhotos, listArticles } from "../lib/data";

const photos = await listPhotos();
const posts  = await listArticles();
const BASE = import.meta.env.BASE_URL || "/";
---

<Layout>
  <html lang="en">
    <head>
      <meta charset="utf-8" />
      <title>Toshi Kuramochi Photography</title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <style>
        body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial; margin:0; padding:2rem; line-height:1.6; background:#fafafa;}
        h1{margin:0 0 1rem;}
        h2{margin:2rem 0 0.5rem;}
        a{text-decoration:none;color:inherit}
        .grid{display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));}
        .card{background:#fff;border:1px solid #eee;border-radius:12px;overflow:hidden;}
        .card img{width:100%;height:220px;object-fit:cover;display:block;}
        .meta{padding:0.75rem 1rem;}
        .small{color:#666;font-size:0.9rem;}
        header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;}
        nav a{margin-left:1rem;color:#06c;}
      </style>
    </head>
    <body>
      <header>
        <h1>Precious Moments — Toshi Kuramochi</h1>
        <nav>
          <!-- Home もサブパスに対応 -->
          <a href={BASE}>Home</a>
          <a href="https://www.instagram.com/">Instagram</a>
          <a href="https://toshi-substack.example/">Newsletter</a>
        </nav>
      </header>

      <h2>Latest Photos</h2>
      <div class="grid">
        {photos.slice(0, 12).map(p => (
          <!-- /photos/... -> BASE + photos/... -->
          <a href={`${BASE}photos/${p.slug}`} class="card">
            <!-- p.image は data.ts 側で BASE 付与済み（付与してなければ `${BASE}photos/${ファイル名}` にする） -->
            <img src={p.image} alt={p.title} loading="lazy" />
            <div class="meta">
              <strong>{p.title}</strong><br/>
              <span class="small">{p.date || ""}</span>
            </div>
          </a>
        ))}
      </div>

      <h2>Journal</h2>
      <div class="grid">
        {posts.slice(0, 6).map(a => (
          <!-- /posts/... -> BASE + posts/... -->
          <a href={`${BASE}posts/${a.slug}`} class="card">
            <!-- cover が "/photos/..." など絶対パスの場合に BASE を前置 -->
            {a.cover && <img src={a.cover.startsWith('/') ? `${BASE.replace(/\/$/, '')}${a.cover}` : a.cover} alt={a.title} loading="lazy" />}
            <div class="meta">
              <strong>{a.title}</strong><br/>
              <span class="small">{a.date}</span>
            </div>
          </a>
        ))}
      </div>
    </body>
  </html>
</Layout>
