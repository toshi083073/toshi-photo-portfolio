---
import Layout from '../../layouts/Layout.astro';
import { getArticleBySlug, listArticles } from '../../lib/data';

export async function getStaticPaths() {
  const posts = await listArticles();
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const post = await getArticleBySlug(slug!);
if (!post) throw new Error(`Post not found: ${slug}`);
---

<Layout title={post.title}>
  <article style="max-width:800px;margin:0 auto;padding:1rem 0 2rem;">
    <h1 style="margin:.25rem 0 0 0;">{post.title}</h1>
    <div style="opacity:.7;margin-bottom:1rem;">{post.date}</div>
    {post.cover && (
      <img
        src={post.cover}
        alt={post.title}
        style="width:100%;height:auto;border-radius:8px;margin:0 0 1rem;"
      />
    )}

    <!-- ★ ここが超重要：innerHTML ではなく set:html を使う -->
    {post.body && <div class="article-body" set:html={post.body} /> }
  </article>
</Layout>

<style>
.article-body {
  line-height: 1.75;
  font-size: 1.05rem;
}
.article-body p { margin: 1rem 0; }
.article-body img { width: 100%; border-radius: 6px; margin: 1rem 0; }
</style>
